## コンテキスト
アプリは Next.js App Router と Server Components を使用し、認証は
middleware に依存せずサーバーサイドで実施する必要がある。

## ゴール / 非ゴール
- ゴール:
  - メール/パスワードのログイン、サインアップ、ログアウト、
    パスワードリセット要求を提供する。
  - `/app` へのアクセスをサーバーサイド認証で保護する。
  - Supabase Auth に沿った最小実装で構成する。
- 非ゴール:
  - OAuth などの外部プロバイダ。
  - リセット完了 UI（メール送信のみ）。
  - 多要素認証。

## 判断
- 判断: すべての認証フローは Supabase Auth API を使用する。
  - 理由: 既定の認証基盤として Supabase を採用しているため。
- 判断: 認証チェックは Server Components かサーバーサイドの
  ハンドラで実施する。
  - 理由: middleware への依存が明示的に禁止されているため。
- 判断: `/login` にログイン/サインアップ/リセット要求を集約する。
  - 理由: MVP の UI/UX を最小化するため。

## リスク / トレードオフ
- サーバーサイドでのセッション処理が不整合になると、
  認証状態が不安定になる可能性がある。
- リダイレクト主体のフローでは、エラー内容の表示を明示しないと
  UX が低下する。

## 移行計画
- 認証ユーティリティとページを追加する。
- `/app` のサーバーサイドガードを追加する。
- ログイン、サインアップ、ログアウト、リセット要求を手動検証する。

## 未解決事項
- なし。
