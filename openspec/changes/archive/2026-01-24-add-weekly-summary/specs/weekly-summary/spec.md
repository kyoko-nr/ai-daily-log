# Capability: 週次サマリー

週単位で日次ログとフォローアップ Q&A を集約し、AI が振り返りサマリーを自動生成する。

## ADDED Requirements

### Requirement: 週次サマリーの自動生成

システム SHALL 毎週月曜日に、前週（月曜〜日曜）の日次ログとフォローアップ Q&A を
集約し、AI サマリーを自動生成して保存する。

サマリーは以下のセクションを含むマークダウン形式とする：
- 今週のハイライト（2-3 項目）
- 学び・気づき
- 課題・改善点
- 来週に向けて

サマリーは保存済みのログと Q&A のみを参照し、存在しない情報を捏造してはならない。

#### Scenario: 前週にログがある場合

- **GIVEN** ユーザーが前週（月曜〜日曜）に 1 件以上の日次ログを記録している
- **AND** ユーザーの週次サマリー自動生成が有効である
- **WHEN** 週次サマリー生成ジョブが実行される
- **THEN** 前週のログとフォローアップ Q&A を集約してサマリーが生成される
- **AND** サマリーが `weekly_summaries` テーブルに保存される
- **AND** サマリーには集約したログ数が記録される

#### Scenario: 前週にログがない場合

- **GIVEN** ユーザーが前週に日次ログを記録していない
- **AND** ユーザーの週次サマリー自動生成が有効である
- **WHEN** 週次サマリー生成ジョブが実行される
- **THEN** サマリーは生成されない
- **AND** エラーは発生しない

#### Scenario: 自動生成が無効なユーザー

- **GIVEN** ユーザーの週次サマリー自動生成が無効である
- **WHEN** 週次サマリー生成ジョブが実行される
- **THEN** そのユーザーのサマリーは生成されない

### Requirement: 週次サマリー自動生成の有効/無効設定

システム SHALL ユーザーごとに週次サマリーの自動生成を有効または無効に設定できる。

デフォルトでは自動生成は有効とする。

#### Scenario: 自動生成を無効に設定

- **GIVEN** ユーザーが認証済みである
- **AND** 週次サマリー自動生成が有効である
- **WHEN** ユーザーが自動生成を無効に設定する
- **THEN** 設定が保存される
- **AND** 以降の Cron ジョブでそのユーザーのサマリーは生成されない

#### Scenario: 自動生成を有効に設定

- **GIVEN** ユーザーが認証済みである
- **AND** 週次サマリー自動生成が無効である
- **WHEN** ユーザーが自動生成を有効に設定する
- **THEN** 設定が保存される
- **AND** 以降の Cron ジョブでそのユーザーのサマリーが生成される
